<project name="weka-package" default="compile" basedir=".">
  <!--
    ===========================================================================
     Ant file for a weka package

     Type ant -projecthelp for targets and descriptions.

     $Revision: 13621 $
    ===========================================================================
  -->

  <!-- set global properties for this build -->
  <property name="src" value="src/main/java"/>
  <property name="src-test" value="src/test/java"/>
  <property name="lib" value="lib"/>
  <property name="data" value="datasets"/>
  <property name="build" value="build"/>
  <property name="dist" value="dist"/>
  <property name="doc" value="doc"/>
  <property name="javac_max_memory" value="256m"/>
  <property name="debug" value="on"/>
  <property name="project.revision" value=""/>

  <!--Base names-->
  <property name="basename" value="wekaDeeplearning4j"/>
  <property name="package_name" value="PLACEHOLDER_PACK_NAME"/>
  <property name="zip_name" value="PLACEHOLDER_ZIP_NAME"/>

  <target name="init_all">
    <!-- Create the time stamp -->
    <tstamp/>
  </target>

  <!-- general classpath definition, incl. CLASSPATH env. variable,
  // but jars in lib directory have precedence over the CLASSPATH variable -->
  <path id="project.class.path">
    <fileset dir="${lib}">
      <include name="*.jar"/>
      <include name="*.zip"/>
    </fileset>
    <pathelement location="${build}/classes"/>
    <pathelement location="${build}/testcases"/>
    <pathelement path="${java.class.path}"/>
  </path>

  <!--
   ============================================================================
   Compilation and documentation making stuff
   ============================================================================
  -->

  <target name="init_compile" depends="init_all">
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${build}/classes"/>
  </target>

  <!-- Compile the java code from ${src}/weka into ${build}/classes -->
  <!-- resolve was previously in depends -->
  <target name="compile" depends="init_compile"
    description="Compile package and deposit class files in build/classes">
    <javac srcdir="${src}"
      fork="yes" memoryMaximumSize="${javac_max_memory}"
      destdir="${build}/classes"
      optimize="${optimization}"
      debug="${debug}"
      deprecation="${deprecation}"
      source="1.8" target="1.8">

      <classpath refid="project.class.path"/>
    </javac>
    <copy todir="${build}/classes">
      <fileset dir="${src}">
        <include name="**/*.gif"/>
        <include name="**/*.png"/>
        <include name="**/*.jpeg"/>
        <include name="**/*.jpg"/>
        <include name="**/*.props"/>
        <include name="**/*.txt"/>
        <include name="**/*.xml"/>
        <include name="**/*.cup"/>
        <include name="**/*.flex"/>
        <include name="**/*.jflex"/>
        <include name="**/*.properties"/>
        <include name="**/*.default"/>
      </fileset>
    </copy>
  </target>

  <!-- Make the javadocs -->
  <target name="docs"
    depends="init_all"
    description="Make javadocs into ./doc">
    <mkdir dir="${doc}"/>
    <javadoc sourcepath="${src}"
      classpathref="project.class.path"
      destdir="${doc}"
      Author="yes"
      Public="yes"
      link="http://weka.sourceforge.net/doc.dev/"
      maxmemory="256m"/>
  </target>


  <!--
    ===========================================================================
    Unit testing stuff
    ===========================================================================
  -->
  <!-- Junit testing initialization -->
  <target name="init_tests" depends="init_all">
    <available property="junit.present" classname="junit.framework.TestCase"/>
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${build}/testcases"/>
    <!-- make this if it doesn't exist so that the compile_test task doesn't faile for
         stuff that doesn't have test cases -->
    <mkdir dir="${src-test}"/>
  </target>

  <!-- compile the testcases -->
  <target name="compile_tests" depends="init_tests, compile"
    description="Compile unit tests into build/testcases">
    <javac srcdir="${src-test}"
      fork="yes" memoryMaximumSize="${javac_max_memory}"
      destdir="${build}/testcases"
      optimize="${optimization}"
      debug="${debug}"
      deprecation="${deprecation}"
      source="1.6" target="1.6">
      <classpath refid="project.class.path"/>
    </javac>
    <copy todir="${build}/testcases">
      <fileset dir="${src-test}">
        <include name="**/*.arff"/>
        <include name="**/*.cost"/>
        <include name="**/*.xml"/>
        <include name="**/*.matrix"/>
      </fileset>
    </copy>
  </target>

  <!--
    ===========================================================================
    Release making stuff
    ===========================================================================
  -->

  <target name="init_dist" depends="init_all">
    <!-- Create the distribution directory -->
    <mkdir dir="${dist}"/>
  </target>

  <!-- Put everything in ${build}/classes into the ${package}.jar file -->
  <target name="exejar" depends="compile, docs, init_dist"
    description="Create a binary jar file in ./dist">
    <jar jarfile="${dist}/${package_name}.jar"
      basedir="${build}/classes">
    </jar>
  </target>


  <target name="finish_package">
    <mkdir dir="${dist}/${package_name}/doc"/>
    <copy todir="${dist}/${package_name}/doc">
      <fileset dir="${doc}">
        <include name="**/*"/>
      </fileset>
    </copy>

    <mkdir dir="${dist}/${package_name}/src"/>
    <copy todir="${dist}/${package_name}">
      <fileset dir=".">
        <include name="*.xml"/>
        <include name="*.properties"/>
        <include name="src/**/*.excludes"/>
        <include name="src/**/*.gif"/>
        <include name="src/**/*.java"/>
        <include name="src/**/*.jpeg"/>
        <include name="src/**/*.jpg"/>
        <include name="src/**/*.props"/>
        <include name="src/**/*.txt"/>
        <include name="src/**/*.xml"/>
        <include name="src/**/*.cup"/>
        <include name="src/**/*.flex"/>
        <include name="src/**/*.jflex"/>
        <include name="src/**/*.properties"/>
        <include name="src/**/*.default"/>
        <include name="src/**/*.cost"/>
        <include name="src/**/*.arff"/>
        <include name="src/**/*.matrix"/>
        <exclude name="src/test/**/*"/>
      </fileset>
    </copy>


    <zip destfile="${dist}/${zip_name}" basedir="${dist}/${package_name}"/>
    <copy file="${dist}/${package_name}/${package_name}.jar" todir="${dist}"/>
  </target>


  <!-- Clean -->
  <target name="clean" depends="init_all"
    description="Removes the build, dist and reports directories">
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
    <delete dir="${doc}"/>
  </target>



  <target name="make_package_cuda">
    <zip destfile="${dist}/${zip_name}" basedir="${dist}/${package_name}"/>
  </target>

  <!--Main target to generate zip files for CPU -->
  <target name="make_package_main">
    <antcall target="exejar">
      <param name="package" value="${package}"/>
    </antcall>

    <move todir="${dist}/${package_name}">
      <fileset dir="${dist}">
        <include name="${package_name}.jar"/>
      </fileset>
    </move>

    <mkdir dir="${dist}/${package_name}/doc"/>
    <copy todir="${dist}/${package_name}/doc">
      <fileset dir="${doc}">
        <include name="**/*"/>
      </fileset>
    </copy>

    <mkdir dir="${dist}/${package_name}/src"/>
    <copy todir="${dist}/${package_name}">
      <fileset dir=".">
        <include name="*.xml"/>
        <include name="*.properties"/>
        <include name="src/**/*.excludes"/>
        <include name="src/**/*.gif"/>
        <include name="src/**/*.java"/>
        <include name="src/**/*.jpeg"/>
        <include name="src/**/*.jpg"/>
        <include name="src/**/*.props"/>
        <include name="src/**/*.txt"/>
        <include name="src/**/*.xml"/>
        <include name="src/**/*.cup"/>
        <include name="src/**/*.flex"/>
        <include name="src/**/*.jflex"/>
        <include name="src/**/*.properties"/>
        <include name="src/**/*.default"/>
        <include name="src/**/*.cost"/>
        <include name="src/**/*.arff"/>
        <include name="src/**/*.matrix"/>
        <exclude name="src/test/**/*"/>
      </fileset>
    </copy>

    <zip destfile="${dist}/${zip_name}" basedir="${dist}/${package_name}"/>
  </target>
</project>
